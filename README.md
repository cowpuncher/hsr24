# Разворачивание существующей верстки #
Для установки модулей зависимости и сборки проекта должен быть установлен node.js версии >=0.12.0
В качестве сборщика используется Gulp.

Необходимо установить глобально Gulp и Bower

1. npm i -g gulp
2. npm i -g bower

Шаги для развёртывания

1. Зайти в директорию, где будет установлена верстка через консоль
2. Клонировать этот репозиторий
3. Зайти в рабочую директорию через консоль
4. Выполнить npm i
5. Выполнить bower i

# Отладка и сборка верстки #
gulp serve - стартует верстку на 9010 порту

gulp build - компилирует верстку в /dist

gulp clean - очищает проект от папок /dist и /.tmp

# Структура проекта #

```html
└── bower_components/  – плагины js (hgignore)
└── node_modules/  – зависимости npm (hgignore)
└── dist/  — содержит собранные готовые к интеграции макеты twig, а так же css и js (hgignore)
└── reports/  — содержит файлы логов и сообщений js-lint и sass-lint (hgignore)
└── app/  — файлы проекта
    └── sprite-templates/  – папка с шаблонами, используемые для генерации спрайтов

    └── responses/  – папка содержащая шаблоны вызываемые xhr-запросом

    └── fonts/  — папка с подключаемыми шрифтами

    └── images/  — папка с графическими элементами макетов
        └── required/  — папка для хранения изображений, которые обязательны для проекта (логотип, фоновые картинки, маркеры, картинки плагинов)
        └── example/  – картинки для наполнения вёрстки.
        └── icons-png/  – иконки png, автоматически генерируются в спрайт. (images/required/sprite.png)
        └── icons-svg/  – иконки svg, автоматически генерируются в спрайт. (images/required/sprite.svg)

	└── js/  — папка с js скриптами (может содержать подкаталоги directives, controllers, filters, и т.п.)
	    └── vendors/  — папка с подключаемыми плагинами, которые не установлены с помощью bower (самописные или не лежащие в репозиториях с общим доступом)	

    └── twig/  — содержит шаблоны страниц с расширением *.twig*
        └── templates/  — содержит импортируемые и расширяемые шаблоны twig

    └── json-data  — содержит файлы *.json* для какой-либо страницы twig. Файл с данными должен именоваться соответственно имени файла страницы twig

    └── scss/  — папка в которой хранятся все scss файлы проекта и подключаемых фреймворков
        └── template_styles.scss — файл импортируемых стилей
        └── _bootstrap.scss  — файл импортов бутстрап, ненужные компоненты закоментировать
        └── bootstrap/  — если используется бутстрап, все файлы стилей (stylesheets/bootstrap) скопировать сюда из bower_components и ничего в них не править
        └── base/  — базовые настройки стилей проекта
            └── normalize.scss  — если не используем бутстрап
            └── overall.scss  — базовые стили
            └── utilities  — специальные стили, которые используются неоднократно для определенной цели
        └── box/  — функциональные блоки, такие как "Один журнал", "сниппет товара" и т.д.
        └── elem/  — повторяющийся элемент в разных блоках, формах, и т.п. Примеры элемента "рейтинг", "показать все"
        └── form/  — форма или различные варианты форм
        └── page  — страницы с уникальным дизайном и оформлением
        └── modal/  — виды модальных окон
        └── helpers/  — миксины, бызовые переменные
        └── plugins/  — стили для разнообразных плагинов на сайте
```

# ВАЖНО! #
Все JS/CSS/HTML плагины устанавливать через bower с ключом --save

Пример установки jQuery:

```javascript
bower i jquery --save
```

Все серверные плагины ставить через NPM с ключом --save-dev

Пример установки плагина для минификации изображений:

```javascript
npm i gulp-imagemin --save-dev
```


# Директории и файлы SCSS #
Обязательно использование методологии [БЭМ](https://ru.bem.info/methodology/quick-start/)

Внутри директори лучше всего создавать файлы (модули) с префиксом директории.

*Примечание:* В отличие от официальной рекомендации, для модификаторов нужно использовать двойное тире (--) вместо одиночного подчёркивания (_)

Пример создания блока формы поиска: form/form-search.scss

*form-search.scss:*

```scss
.form-search {
  background: #dedede;
  padding: 10px;
  &__input { // .form-search__input - элемент блока 'поиск'
    font-size: 40px;
  }
  &__button { // .form-search__button - элемент блока 'поиск'
    margin: 2rem 0;
  }
  &--fixed {  // .form-search--fixed - модификатор блока 'поиск'
    position: fixed;
  }
  &--theme_pink {  // .form-search--theme_pink - модификатор блока 'поиск'
    background: pink;
  }
}
```

## Директории cтилей ##
* *box* - функциональный блок, такой как "Один журнал", "сниппет товара" и т.д.
* *elem* - повторяющийся элемент в разных блоках, формах, и т.п. Примеры элемента "рейтинг", "показать все"
* *form* - форма или различные варианты форм
* *plugins* - стили для разнообразных плагинов на сайте

Конечно же, корневых директорий может быть сколько угодно и создаваться под любые нужды, к примеру:

* *page* - страницы с уникальным дизайном и оформлением
* *gallery* - галереи. Можно сюда засунуть и слайдер
* *modal* - виды модальных окон
* ...

В данном сборщике работает автодобавление постфикса к стилю для избежания использования закэшированного файла стиля.
За это отвечает задача *styles_version*. При выполнении *gulp build* она переписывает конструкцию 

```html
<!-- build:styles_version -->
<link rel="stylesheet" href="template_styles.css">
<!-- endbuild -->
```
на такую

```html
<link rel="stylesheet" href="template_styles.min.css?v20170505121324">
```
т.е. добавляет *'?v'+датаВремя* сборки

# Как генерируются спрайты #
За генерацию изображений и стилей спрайтов отвечают две задачи в файле gulpfile.babel.js: *sprite-png* и *sprite-svg*. По умолчанию они полностью закоментированы и их вызов в зависимостях других задач закоментирован.
Задача *sprite-png* внутри текста стилей добавляет к названию изображения спрайта постфикс *'?v'+датаВремя* сборки, для предотвращения подтягивания изображения из кэша.

# Как генерируются js-скрипты #
В любом исходном файле twig директории app/twig необходимо использовать такую структуру

```html
<!-- build:js sample/app.js -->
<script src="js/main.js"></script>
<script src="js/other.js"></script>
<!-- endbuild -->
```

В данном примере после выполнения *gulp build* происходит конкатенация файлов js/main.js и js/other.js в файл app.js, который помещается в директорию dist/sample/
Директория sample показана для примера, необходимо все скрипты генерировать в js. Можно генерировать в подпапки вот так:

```html
<!-- build:js js/app-controllers/allControllers.js -->
<script src="js/controllers/modals.js"></script>
<script src="js/other-folder/formController.js"></script>
<script src="js/vendors/angular-form-validate.js"></script>
<!-- endbuild -->
```
В вышеописанном примере скрипты собирутся в dist/js/app-controllers/allControllers.js

# Как работает компиляция twig #
После запуска команды *gulp serve* на лету происходит компиляция twig в html во временную папку .tmp корня проекта. Используется gulp-twig совместно с gulp-data. Из этой временной папки проект доступен по адресу http://localhost:9010/ для удобства фронтэнд разработчику. 
При изменениях в любом файле (*.twig, *.scss, *.js) происходит сборка во временную папку и обновление браузера. Непосредственно html-файлы не доступны для редактирования, работаем через twig

# Как происходит сборка #
Послы выполнения команды *gulp build* происходит сборка:

* стили - в dist двумя файлами template_styles.css и template_styles.min.css
* скрипты - в dist/js
* twig - в корень dist без директории twig, сохраняя структуру из папки app/twig. 
Папка json-data и файлы html не переносятся в dist, для удобства использования twig-шаблонов back-end разработчиками.Данные будут передаваться через PHP

```php
echo $twig->render('index.html', array('the' => 'variables', 'go' => 'here'));
```
Нужно на этапе вёрстки front-end и back-end разработчикам договориться об именах переменных передаваемых конкретному шаблону (странице, элементу и т.п.) для того чтобы была более продуктивная работа.

# Команды для быстрого добавления файлов #
* Добавление компонентов
  Компоненты можно добавить командами:
  * gulp add --component nameComponent - в этом случае в папке app/components/ui/ создастся папка с названием nameComponent, в которой будут лежать 3 файла scss, js, twig с указанным названием
  * gulp add --component nameComponent --twig - в этом случае в папке app/components/ui/ создастся папка с названием nameComponent, в которой будет лежать 1 файл twig с указанным названием, аналогичная команда для css и js файлов
* Добавление страницы
Страницы добавляются командами:
  * gulp add --page namePage - в этом случае в папке app/page/ создастся файл с названием namePage.twig и в папке app/json-data  файл - namePage.json, который будут содержать структуру из index.json файла
  *  gulp add --page namePage form namePage2 - в этом случае в папке app/page/ создастся файл с названием namePage.twig и в папке app/json-data  файл - namePage.json, который будут содержать структуру из namePage2.json файла
  
